<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Equalizador com Presets</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
    input[type="range"] { width: 300px; margin: 10px; }
    canvas { display: block; margin: 20px auto; background: #222; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    label span { margin-left: 10px; color: #0f0; }
    #presetLabel { margin-top: 10px; font-weight: bold; color: #0ff; }
  </style>
</head>
<body>
  <h2>ðŸŽ§ Equalizador com Presets</h2>
  
  <input type="file" id="fileInput" accept="audio/*"><br>
  <audio id="audio" controls></audio><br>

  <label>Grave (-60 a 60) <span id="bassVal">0</span></label><br>
  <input type="range" id="bass" min="-60" max="60" value="0"><br>
  <label>MÃ©dio (-30 a 30) <span id="midVal">0</span></label><br>
  <input type="range" id="mid" min="-30" max="30" value="0"><br>
  <label>Agudo (-30 a 30) <span id="trebleVal">0</span></label><br>
  <input type="range" id="treble" min="-30" max="30" value="0"><br>

  <div>
    <button onclick="setPreset('rock')">ðŸŽ¸ Rock</button>
    <button onclick="setPreset('jazz')">ðŸŽ· Jazz</button>
    <button onclick="setPreset('pop')">ðŸŽ¤ Pop</button>
    <button onclick="resetFilters()">ðŸ”„ Resetar</button>
    <button onclick="boostBass()">ðŸ’¥ Super Bass</button>
  </div>

  <div>
    <button onclick="exportSettings()">ðŸ“¤ Exportar Ajustes</button>
    <label>
      ðŸ“¥ Importar Ajustes
      <input type="file" id="importSettings" accept=".json" style="display: inline;">
    </label>
  </div>

  <p id="presetLabel">Preset: Nenhum</p>

  <canvas id="canvas" width="800" height="300"></canvas>

  <script>
    const fileInput = document.getElementById('fileInput');
    const audio = document.getElementById('audio');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const bassControl = document.getElementById('bass');
    const midControl = document.getElementById('mid');
    const trebleControl = document.getElementById('treble');

    const bassVal = document.getElementById('bassVal');
    const midVal = document.getElementById('midVal');
    const trebleVal = document.getElementById('trebleVal');

    const presetLabel = document.getElementById('presetLabel');

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    const source = audioCtx.createMediaElementSource(audio);

    const bassFilter = audioCtx.createBiquadFilter();
    bassFilter.type = "lowshelf";
    bassFilter.frequency.value = 200;

    const midFilter = audioCtx.createBiquadFilter();
    midFilter.type = "peaking";
    midFilter.frequency.value = 1000;
    midFilter.Q.value = 1;

    const trebleFilter = audioCtx.createBiquadFilter();
    trebleFilter.type = "highshelf";
    trebleFilter.frequency.value = 3000;

    source.connect(bassFilter);
    bassFilter.connect(midFilter);
    midFilter.connect(trebleFilter);
    trebleFilter.connect(analyser);
    analyser.connect(audioCtx.destination);

    // Sliders input
    bassControl.oninput = () => {
      bassFilter.gain.value = bassControl.value;
      bassVal.textContent = bassControl.value;
      presetLabel.textContent = "Preset: Personalizado";
    };
    midControl.oninput = () => {
      midFilter.gain.value = midControl.value;
      midVal.textContent = midControl.value;
      presetLabel.textContent = "Preset: Personalizado";
    };
    trebleControl.oninput = () => {
      trebleFilter.gain.value = trebleControl.value;
      trebleVal.textContent = trebleControl.value;
      presetLabel.textContent = "Preset: Personalizado";
    };

    // Arquivo de Ã¡udio
    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (file) {
        const url = URL.createObjectURL(file);
        audio.src = url;
        audio.play();
      }
    });

    // VisualizaÃ§Ã£o
    function draw() {
      requestAnimationFrame(draw);
      analyser.getByteFrequencyData(dataArray);

      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const barWidth = (canvas.width / bufferLength) * 2.5;
      let x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const barHeight = dataArray[i];
        ctx.fillStyle = `hsl(${barHeight * 2}, 100%, 50%)`;
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
        x += barWidth + 1;
      }
    }

    audio.onplay = () => {
      audioCtx.resume();
      draw();
    };

    // Presets
    function setPreset(style) {
      const presets = {
        rock: { bass: 20, mid: 5, treble: 15 },
        jazz: { bass: 10, mid: 15, treble: 5 },
        pop:  { bass: 15, mid: 10, treble: 20 }
      };
      const preset = presets[style];
      applySettings(preset);
      presetLabel.textContent = "Preset: " + style.charAt(0).toUpperCase() + style.slice(1);
    }

    function resetFilters() {
      const flat = { bass: 0, mid: 0, treble: 0 };
      applySettings(flat);
      presetLabel.textContent = "Preset: Nenhum";
    }

    function boostBass() {
      const settings = { bass: 45, mid: midControl.value, treble: trebleControl.value };
      applySettings(settings);
      presetLabel.textContent = "Preset: Super Bass";
    }

    function exportSettings() {
      const settings = {
        bass: Number(bassFilter.gain.value),
        mid: Number(midFilter.gain.value),
        treble: Number(trebleFilter.gain.value)
      };
      const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'equalizer-settings.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function applySettings({ bass, mid, treble }) {
      bassControl.value = bass;
      midControl.value = mid;
      trebleControl.value = treble;
      bassFilter.gain.value = bass;
      midFilter.gain.value = mid;
      trebleFilter.gain.value = treble;
      bassVal.textContent = bass;
      midVal.textContent = mid;
      trebleVal.textContent = treble;
    }

    // ImportaÃ§Ã£o com validaÃ§Ã£o
    document.getElementById('importSettings').addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const settings = JSON.parse(e.target.result);
          if (settings.bass !== undefined && settings.mid !== undefined && settings.treble !== undefined) {
            applySettings(settings);
            presetLabel.textContent = "Preset: Importado";
          } else {
            alert("Arquivo de configuraÃ§Ãµes invÃ¡lido.");
          }
        } catch (error) {
          alert("Erro ao importar configuraÃ§Ãµes. Verifique o arquivo.");
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
